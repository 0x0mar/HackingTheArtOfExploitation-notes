tasques 06/06/2012

12/07/2012
	dsniff + sslstrip + airoscript
		wifiway ok
		wifiway usb ok
		airoscript en debian erro

		dsniff - arpspoof
			prova re-arping victims (desactivacio de l'atac)

		sslstrip
			prova atacs que funcionen (pagines vulnerables)
			prova detecció resultats (via script?) i desactivació

	programacio decode_sniff.c + crear packet i reenviar 



Resum Exploitation
================

	programming errors: off by one, range of M items between N, character encoding,…

	generalized techniques
	----------------------
		buffer overflow, strcpy()
		stack configuration, stack frame
		notesearch.c

	Stack based BOF
	---------------
		int auth_flag = 0
		char Password_buffer[16];

		vars declared in that order -> Password_buffer overflow can overwrite auth_flag

		stack: loca vars
			saved frame pointer: EBP or sfp
			return address
			funcion arguments

		1-> overwritting local vars
		2-> overwritting return address

	gdb
		gcc -g (for debugging with code source)
		gdbb -q (suppres welcome banner)
		(gdb) list 1 (1 is the firs line of c code)
		(gdb) break 9
		(gdb) x/16xw  (16 items, format hexadecimal, tamany word=4bytes)
		(gdb) print 0xbffff7f4 - 0xbfff7e0  (used as a calculator)
		(gdb) i r esp
		(gdb)x/24s $esp + 0x240 (to see env vars)

	Experimenting with BASH
	-----------------------

		(gdb run $(perl -e 'print "A"x28 . "\x45\x02\x78")
		0-little-endian order in the mem addresses…in the payload write in little endian order		
		1-metode 1, llegir del gdb l'adressa de on comensa la variable overflowable, i llavors pasar en el overflow en posiciod e sobreescriure la return addr, -> prova error o gdb

		2-OVERWRITE RET ADDRESS:, repetir adreça de retorn ALINEADA en tot el buffer i en alguna posicio coincidira amb el return address

		3-(SHELLCODE) return address overwritten with an address of the buffer which contains the code -> SHELLCODE for spawning a shell. Devastating for programs suid root


		4-Metode 1 - AVOID DIFFICULT PREDICTION OF MEM ADDRESS OF SHELCODE -> fill with return address, inject a nop sled at the beginning, inject shellcode in the middle.
			NOP SLED | SHELLCODE | address to NOP sled repeated


		5-Metode 2 - AVOID DIFFICULT PREDICTION OF MEM ADDRESS OF SHELLCODE -> use a nearby stack location as a frame of reference. Exploit from a program like "exploit_notesearch.c"
		->declare a var "unsigned int i" inside the program, then build the nop sled, shellcode + return address payload
		-> uses an offset set by the user -> so needs experiment
		
		5-Metode 2- AVOID DIFFICULT PREDICTION OF MEM ADDRESS OF SHELLCODE -> bash for experimenting
			for experimenting with the offset
			#for i in $(seq 1 3 10)
			> do
			>echo The Value is $i
			> ./exploit_notesearch $i
			> done


	0x331 Using The Environment
	---------------------------

		6-Metode Env var 1 - buffer too small to hold the shellcode - use an environment variable
			a-put shellcode into an env variable with NOP SLED
				export SHELLCODE=$(perl -e 'print "\x90"x20')$(cat shellcode.bin)
			b-run gdb with the program, examien x/24s $esp + 0x240 to see where is located the env var SHELLCODE. running with gbd modifies mem addresses but 200 nop's help

		7-Metode Env Var 2 - Env var location prediction (NOP SLED not needed)
			getenv_example.c -> program name affects @ of env vars
			-> pointer = getenv(env var) + (strlen(getenvaaddr) - strlen(targetprogram))*  -> getenvaddr.c

			export SLEDLESS=$(cat shellcode.bin)
			./getenvaddr SLEDLESS notesearch
				SLEDLESS will be at 0xbfffff4b
			./notesearch $(perl -e 'print "\x4b\xff\xff\xbf"x40')
			sh-3.2#


		8- Metode Env var 3 - execle() with env var - exact address for the env var
			execle() argument explanation:
				1-path to targe program
				2-argv[0] param (name of the program)
				3-argv's
				n-NULL to terminate the argument list
				env-array of pointers to null terminated strings (for each env var name) and a NULL pointer at the end

			if only one env var its address is:
			0xbffffffa - length of env var name - length of program name
			shellcode[] = "…."
			char *env[2] = {shellcode, 0}			
			ret = 0xbffffffa - (sizeof(shellcode) -1 ) - strlen("./notesearch");	
			buffer is fiiled with ret, 160/4 times
			execle("./notesearch", "notesearch", buffer, 0 , env);
			free(buffer)

		0x340 Overfloes in other segments
		---------------------------------

-----------------------------------------------------------------------------------------
ESTUDI


llibre hacking - avanç mes proves mitm
projecte albert provar
emlseekanddestroy algun dia fer una hora

estudiar 4 hores(6 hores) + 1h projecte  + 1h musica  + dia coses extra (android, arduino, wifi, api's, set webserver + mitm)

	0 - airoscript + dsniff + sslstrip
	1er -active sniffing -> arp spooffing 
	2on -decode_sniff.c
	3er -reenviar sockets
	     modificar i reenviar sockets
	     lectura i comprensio


IDEA 2
	4 hores de llibre (lectura `+ proves)
	1 h projecte albert / 1h android
	1h musica / guitarra / harmonia / renoise / masteritzacio / bateria
Extres:
	arduino / vim-emacs-xcode / objective C aplicacions per Mac OS X / wifi pentest

----------------------------------------------------------------------------------------
GESTIONS

MATRICULA UOC
ok-demanda
MUTUA

ok-DERMATOLEG ANAR
ALERGIES DEMANAR
ok-OMEPRAZOL COMPRAR
revisio d'aqui un mes  (o quan s'acabi el omeprazol)

aigua compte bancaria

backup mobil - agenda, contactes, fotos
restaurar movil? o demaanr reparacio en garantia

---------------------------------------------------------------------------------------
COMPRES

comprar sofa

ok-crimpadora
ok-clau anglesa
ok-grapadora 
ok-SERVEI ESTACIO?


COMPRAR teclat midi i tarjet usb -> microfusa?

traslladar calaxeres que no utilitzo

ok-compra pantas curts cremallera, samarreta, windstopper, xancles i banaydor

arduino compres
===============
	voltimetro
	micro
	altaveu
	mosfet?? per la llum?

	resistencies, 
	cable, 
	tallador cable, 
	protoboards
	condensadors?

	plata jtag, I2c

--------------------------------------------------------------------------------------
AJUDES

llistat imagenio ono
pantalles i teclat per despatx
web bufet

descarrega de windows 7 i 8 desde enllaç uoc o desde web microsoft
divxclassico emule i torrent

-------------------------------------------------------------------------------------
SOCIAL

mail joaquim
linked in  i juanca

dinar juanca

facebook victor i pol


ok-facebook taurs correr
ok-sanfe trucar feclicitar i dir que m'apunto
ok-facebook roger lara acrobacies
ok-trucar alberto acrobacias migdia tarda
ok-facebook salva 
ok-facebook lucas ?
ok-mail hugo
ok-mail juanca mirar primer instalacio pq el nom del programa ha canviat!
ok-mail roger sopar dimarts
ok-mail arduino
ok-TRANSFERENCIA BANCARIA TRANSPORT ARUDINO
ok-desmontar armari

planning project dni
lectura Hacking


	

eml
===

	OK-reports ordre alfabetic
	ok-database combo box + boot new
		ok-self.comboDatabaseName -ok
		ok-ONDirDest -> omplir combobox, com???
			self.comboDBnameList = []
		ok-funcio omplir combobox, lectura directori buscar .db's
			ok-funcio llegir dir en busca de db's
			ok-funcio omplir combobox 
			ok-funcio afegir a combobox
		ok-boto new databaseName
			-usar funcio afegir a combobox i modificar SetSelection()
			-dialog modal amb texxtCtrl...
		ok-USAR SELECTIO DEL COMBOBOX AL PROGRAMA
			ok-on combo box selection change -> modifier a variable intern  				self.casename o alga aixi
			ok-EVT_COMBOBOX	Sent when an item on the list is selected. Note that calling GetValue i
		ok-col·locacio adient

	ok-enablebuttons disable button -> variable botons search, extract i writeReport
		self.extractEnable = False
		self.searchEnable = False
		self.reportEnable = False

		self.button3Extract.Enable(False)    
	        self.searchButton.Enable(False)
	        self.reportButton.Enable(False)

	ok-insertar tots els files a la bd
		ok-testing amb decodificar

	-batch processing 
			(introudir extraction, 
			search i potser report tambe  
			i despres executar tot)

	-error open list!!
		a vegades falla i a vegades no..		
		solución per a que no es queddi penjat,
		-retorni error i es pugui tornar a repetir operacio
		-messagebox alerta error, repetir

	-REPORTS 
		-parentesis….en reports, plantear como arbol
		
	-poner regexp en la bd?
	-log escriure a disk!
	-manual de instruccions
	
			
---------------------------------

	ok-en reports si adjunto copiar también correo original
		no-al extreure es podrien asociar---complicat
		no- al crear les llistes es podrien insertar directament a la bd i afegir nou camp per els adjunts
		no-algoritme de cerca, -> afegir a la bd.. (problema threads exclusio mutua, semafors…)
		-timing
			ok-threads repas
			ok-semafors, exclusio mutua, acces compartit a un recurs
			http://mundogeek.net/archivos/2008/04/18/threads-en-python/

			ok-Decoder: cada adjunt que s'extregui s'ha de inserir a la bd amb info de qui es el pare e inserir el pare tambe
			ok-quan es llegeix la llista de cerca, al inserir a la bd mirar si fitxer ja existeix
			ok-al copiar fitxers en els reports, copiar tambe el file-pare si te pare, i posar tambe el file-pare en el report.

			ok-ordre alphabetic
			ok-testejar!
		
	-NOT
		-problema, en las búsquedas no salen los not
		… tener en cuenta…		que es un subconjunto, no es del total	
		-insertar a la bd tots els files...

	-USABILITAT
		
		ok-folder per defecte a pst folder? self.DefaultSavePath
		ok-tema database name…amb  boto per buscar
		ok-tema destination folder, case folder, working directory
		ok-tema del boto de Search -> posar al tab de Search

		ok-desactivar tabs si no database name, o case folder
		ok-desactivar Search si no hi ha cap llista, 
		ok-desactivar Extract si no hi ha pst folder,
		ok-desactivar report si no hi ha elements seleccionats
			buttons:
			  ok-self.button3Extract.Enable(False)    
        		  ok-self.searchButton.Enable(False)
			  ok-self.reportButton.Enable(False)

			ok-initializations disable buttons
			on pstfolder, 
			on search list open/save/add, 
			on report list add
			

		-testing
			ok-problema database name (ruta sencera?, nomes nom i dir? …)
				ok-solucio:
					database name combo box and db's del "case folder"
					+ boto per crear nova, donant-li un nom
			ok-extractor
				ok-extract extreu a self.Dirdest + /eml/
			-search
				ok-error exception database… solucionat?
				-reports

		-neteja comentaris





	ok-disabling de controls
	ok-pantalla de final de execucio de tasques
	ok-disabling de pestanyes tabs
	ok-tabulador moure per controls
		

	ok-nombre report con operador, titulo report con operacion
	ok-operador not en reports ( problema con report que tiene mas de un keyword)
	
	

	ok-directory per defects (sobretot per save y open a "search") defaultSavePathValue
	ok- funcio save com save as si encara no s'ha salvat
	ok-nombre de caso - nombre de bd, abrir..


	ok-manual instalación backtrack5

	

